<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: gpu | LESS IS MORE]]></title>
  <link href="http://r9y9.github.io/blog/categories/gpu/atom.xml" rel="self"/>
  <link href="http://r9y9.github.io/"/>
  <updated>2015-12-08T00:50:33+09:00</updated>
  <id>http://r9y9.github.io/</id>
  <author>
    <name><![CDATA[Ryuichi YAMAMOTO]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Pylearn2, theanoをEC2 g2.x2large で動かす方法]]></title>
    <link href="http://r9y9.github.io/blog/2014/07/20/pylearn2-on-ec2-g2-2xlarge/"/>
    <updated>2014-07-20T23:22:00+09:00</updated>
    <id>http://r9y9.github.io/blog/2014/07/20/pylearn2-on-ec2-g2-2xlarge</id>
    <content type="html"><![CDATA[<p><img class="center" src="/images/dbm_learned_from_mnist.png" title="&ldquo;Weight visualization of Restricted bolztomann machine trained on MNIST dataset.&rdquo;" ></p>

<h2>モチベーション</h2>

<ul>
<li>手元のへぼマシンでニューラルネットの学習を回わす</li>
<li>半日たっても終わらない</li>
<li>最近だとGPU使って計算を高速化するのが流行りだが、手元にGPUはない</li>
</ul>


<p><a href="http://www.kurtsp.com/deep-learning-in-python-with-pylearn2-and-amazon-ec2.html">Deep Learning in Python with Pylearn2 and Amazon EC2</a></p>

<p>手元にGPUがない…？大丈夫！Amazon EC2を使えば良さそう！！！</p>

<p>というわけで、めんどくさいと言わずにec2にお手軽計算環境を整えます。ec2でGPUが乗ったものだと、g2.2xlargeがよさそうですね。</p>

<p>ちなみに↑の図、pylearn2のtutorialのRestricted Bolzmann MachinesをMNISTで学習した結果なんですが、手元のマシンだとだいたい6時間くらい？（忘れた）だったのがg2.2xlargeだと30分もかかってない（ごめんなさい時間図るの忘れた）。$0.65/hourと安いんだし（他のインスタンスに比べればそりゃ高いけど）、もう手元のマシンで計算するの時間の無駄だしやめようと思います。</p>

<p>さてさて、今回環境構築に少しはまったので、もうはまらないように簡単にまとめておきます。</p>

<h2>結論</h2>

<p><a href="https://aws.amazon.com/marketplace/pp/B00FYCDDTE">Amazon Linux AMI with NVIDIA GRID GPU Driver on AWS Marketplace </a></p>

<p>すでにNVIDIAのドライバとCUDA（5.5）が入ったインスタンスをベースに使いましょう。</p>

<p><a href="http://xanxys.hatenablog.jp/entry/2014/05/17/135932">EC2(g2.2xlarge)でOpenGLを使う方法</a> で挙げられているように普通のlinuxを使う方法もありますが、ハマる可能性大です。僕はubuntuが使いたかったので最初はubuntu 14.04 server でドライバ、cuda (5.5 or 6.0) のインストールを試しましたが同じように失敗しました。</p>

<p>イケイケと噂の音声認識ライブラリKaldiの<a href="https://220-135-252-130.hinet-ip.hinet.net/speechwiki/index.php/Kaldi#installing_and_testing_CUDA-6.0_in_Ubuntu_14.04">ドキュメントらしきもの</a>を見ると、Ubuntu 14.04でもcuda 6.0インストールできるっぽいんですけどね…だめでした。頑張ればできるかもしれませんが、よほど強いメリットがない場合は、おとなしくpre-installされたインスタンスを使うのが吉だと思います。</p>

<h2>セットアップ</h2>

<p>↑で上げたインスタンスにはGPUドライバやCUDAは入っていますが、theanoもpylearn2もnumpyもscipyも入っていません。よって、それらは手動でインストールする必要があります。</p>

<p>というわけで、インストールするシェルをメモって置きます。試行錯誤したあとに適当にまとめたshellなので、なんか抜けてたらごめんなさい。</p>

<p><a href="https://gist.github.com/r9y9/50f13ba28b5b158c25ae">https://gist.github.com/r9y9/50f13ba28b5b158c25ae</a></p>

<p>```bash</p>

<h1>!/bin/bash</h1>

<h1>Pylearn2 setup script for Amazon Linux AMI with NVIDIA GRID GPU Driver.</h1>

<h1><a href="http://goo.gl/3KeXXW">http://goo.gl/3KeXXW</a></h1>

<p>sudo yum update -y
sudo yum install -y emacs tmux python-pip
sudo yum install -y python-devel git blas-devel lapack-devel</p>

<h1>numpy, scipy, matplotlib, etc.</h1>

<p>sudo pip install numpy
sudo pip install scipy
sudo pip install cython
sudo pip install ipython nose</p>

<h1>matplotlib</h1>

<p>sudo yum install -y libpng-devel freetype-devel
sudo pip install matplotlib</p>

<h1>Scikit-learn</h1>

<p>sudo pip install scikit-learn</p>

<h1>Theano</h1>

<p>sudo pip install &mdash;upgrade git+git://github.com/Theano/Theano.git</p>

<h1>Enable GPU for theano</h1>

<p>echo &lsquo;[global]
floatX = float32
device = gpu0</p>

<p>[nvcc]
fastmath = True' > .theanorc</p>

<h1>pylearn2</h1>

<p>git clone git://github.com/lisa-lab/pylearn2.git
cd pylearn2
sudo python setup.py develop
cd ..</p>

<p>echo &ldquo;export PYLEARN2_DATA_PATH=/home/ec2-user/data&rdquo; >> .bashrc</p>

<h1>MNIST dataset</h1>

<p>mkdir -p data/mnist/
cd data/mnist/
wget <a href="http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz">http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz</a>
gunzip train-images-idx3-ubyte.gz
wget <a href="http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz">http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz</a>
gunzip train-labels-idx1-ubyte.gz
wget <a href="http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz">http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz</a>
gunzip t10k-images-idx3-ubyte.gz
wget <a href="http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz">http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz</a>
gunzip t10k-labels-idx1-ubyte.gz
cd ../..
```</p>

<p>簡単ですね</p>

<p>また、上記のような手順を踏まなくても、Community AMIs でpylearn2で検索するとすでにpylearn2が入ったAMIが出てくるので、それを使うのもありかもです（僕は試してません）。</p>

<p>僕がAMIを公開してもいいんですが、今のところする予定はありません</p>

<h1>まとめ</h1>

<p>そこそこ良い計算環境がさくっとできました、まる。ラーメン食べたい</p>

<h2>参考</h2>

<ul>
<li><a href="http://aws.amazon.com/jp/ec2/instance-types/">インスタンスタイプ &ndash; Amazon EC2 (クラウド上の仮想サーバー Amazon Elastic Compute Cloud) | アマゾン ウェブ サービス（AWS 日本語）</a></li>
<li><a href="http://www.kurtsp.com/deep-learning-in-python-with-pylearn2-and-amazon-ec2.html">Deep Learning in Python with Pylearn2 and Amazon EC2</a></li>
<li><a href="http://xanxys.hatenablog.jp/entry/2014/05/17/135932">EC2(g2.2xlarge)でOpenGLを使う方法</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
